

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Email &mdash; PurdueCAM2Project/CAM2WebUI 1.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Admin" href="Admin.html" />
    <link rel="prev" title="Camera Pop Up View" href="CameraPopUpView.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> PurdueCAM2Project/CAM2WebUI
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Basic Setup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../basicSetup/git.html">Git and GitHub</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basicSetup/heroku.html">Heroku</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basicSetup/localsite.html">Viewing Website Locally</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basicSetup/selenium.html">Selenium Test Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basicSetup/sphinx.html">Sphinx-generated Github Page</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basicSetup/travis.html">Travis CI Setup</a></li>
</ul>
<p class="caption"><span class="caption-text">Implementation Details</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="User.html">User</a></li>
<li class="toctree-l1"><a class="reference internal" href="GoogleFusionTable.html">Google Fusion Table</a></li>
<li class="toctree-l1"><a class="reference internal" href="CameraPopUpView.html">Camera Pop Up View</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Email</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#user-email-confirmation">1. User Email Confirmation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#contact-us">2.Contact Us</a></li>
<li class="toctree-l2"><a class="reference internal" href="#send-email-from-admin">3. Send Email from Admin</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="Admin.html">Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="AppList.html">App List</a></li>
<li class="toctree-l1"><a class="reference internal" href="load_latlngJSON.html">load_latlngJSON</a></li>
</ul>
<p class="caption"><span class="caption-text">Test Setup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../test/test.html">Django Selenium test</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PurdueCAM2Project/CAM2WebUI</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Email</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/implementationDetail/Email.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="email">
<span id="email"></span><h1>Email<a class="headerlink" href="#email" title="Permalink to this headline">¶</a></h1>
<div class="section" id="user-email-confirmation">
<span id="user-email-confirmation"></span><h2>1. User Email Confirmation<a class="headerlink" href="#user-email-confirmation" title="Permalink to this headline">¶</a></h2>
<p>Email user to confirm registration and notify administrator after user registered.</p>
<div class="section" id="approach">
<span id="approach"></span><h3>Approach<a class="headerlink" href="#approach" title="Permalink to this headline">¶</a></h3>
<p>Useful <a class="reference external" href="https://simpleisbetterthancomplex.com/tutorial/2017/02/18/how-to-create-user-sign-up-view.html">tutorial</a></p>
<p>After the code of register, add the following to email user and admin:
Under <code class="docutils literal"><span class="pre">model1</span> <span class="pre">=</span> <span class="pre">form1.save(commit=False)</span></code>, add</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">model1</span><span class="o">.</span><span class="n">is_active</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">#Will be set True after users confirm their email.</span>
</pre></div>
</div>
<p>so that the account will be inactive until users confirm their email.</p>
<p>And the body of email user and admin is the following:</p>
<p>We will use a template to email users, and the template will have username, a link to confirm adn activate user&#8217;s account, and some content.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#Email user</span>
<span class="n">current_site</span> <span class="o">=</span> <span class="n">get_current_site</span><span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="c1">#will be used in website signiture</span>
<span class="n">subject</span> <span class="o">=</span> <span class="s1">&#39;Activate Your CAM2 Account&#39;</span>
<span class="n">message</span> <span class="o">=</span> <span class="n">render_to_string</span><span class="p">(</span><span class="s1">&#39;app/confirmation_email.html&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">model1</span><span class="p">,</span>
    <span class="s1">&#39;domain&#39;</span><span class="p">:</span> <span class="n">current_site</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span>
    <span class="s1">&#39;uid&#39;</span><span class="p">:</span> <span class="n">urlsafe_base64_encode</span><span class="p">(</span><span class="n">force_bytes</span><span class="p">(</span><span class="n">model1</span><span class="o">.</span><span class="n">pk</span><span class="p">)),</span>
    <span class="s1">&#39;token&#39;</span><span class="p">:</span> <span class="n">account_activation_token</span><span class="o">.</span><span class="n">make_token</span><span class="p">(</span><span class="n">model1</span><span class="p">),</span>
<span class="p">})</span>
<span class="n">model1</span><span class="o">.</span><span class="n">email_user</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</pre></div>
</div>
<p>We will use a Django function mail_admins to notify admin when a user is registered.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#Email admin</span>
<span class="n">admin_subject</span> <span class="o">=</span> <span class="s1">&#39;New User Registered&#39;</span>
<span class="n">admin_message</span> <span class="o">=</span> <span class="n">render_to_string</span><span class="p">(</span><span class="s1">&#39;app/new_user_email_to_admin.html&#39;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">model1</span><span class="p">,</span>
    <span class="s1">&#39;optional&#39;</span><span class="p">:</span> <span class="n">model2</span><span class="p">,</span>
<span class="p">})</span>
<span class="n">mail_admins</span><span class="p">(</span><span class="n">admin_subject</span><span class="p">,</span> <span class="n">admin_message</span><span class="p">)</span>
</pre></div>
</div>
<p>And redirect the page to a page that tells user the confirmation email has been sent:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;email_confirmation_sent&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">token</span></code> in email template will be randomly generated based on user&#8217;s information.
Create a new file called <code class="docutils literal"><span class="pre">tokens.py</span></code> and add the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.tokens</span> <span class="k">import</span> <span class="n">PasswordResetTokenGenerator</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="k">import</span> <span class="n">six</span>

<span class="k">class</span> <span class="nc">AccountActivationTokenGenerator</span><span class="p">(</span><span class="n">PasswordResetTokenGenerator</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_make_hash_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span> <span class="o">+</span> <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span> <span class="o">+</span>
            <span class="n">six</span><span class="o">.</span><span class="n">text_type</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">registeruser</span><span class="o">.</span><span class="n">email_confirmed</span><span class="p">)</span>
        <span class="p">)</span>

<span class="n">account_activation_token</span> <span class="o">=</span> <span class="n">AccountActivationTokenGenerator</span><span class="p">()</span>
</pre></div>
</div>
<p>In addition, we need links for confirmation and successful activation:
go to <code class="docutils literal"><span class="pre">urls.py</span></code> and add:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^activate/(?P&lt;uidb64&gt;[0-9A-Za-z_\-]+)/(?P&lt;token&gt;[0-9A-Za-z]{1,13}-[0-9A-Za-z]{1,20})/$&#39;</span><span class="p">,</span>
    <span class="n">app_views</span><span class="o">.</span><span class="n">activate</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;activate&#39;</span><span class="p">),</span>
<span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^account_activated/$&#39;</span><span class="p">,</span> <span class="n">app_views</span><span class="o">.</span><span class="n">account_activated</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;account_activated&#39;</span><span class="p">),</span>
</pre></div>
</div>
<p>Now we will work on the activation function. In <code class="docutils literal"><span class="pre">views.py</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">uidb64</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span> <span class="c1">#Get user</span>
        <span class="n">uid</span> <span class="o">=</span> <span class="n">force_text</span><span class="p">(</span><span class="n">urlsafe_base64_decode</span><span class="p">(</span><span class="n">uidb64</span><span class="p">))</span>
        <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">uid</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">OverflowError</span><span class="p">,</span> <span class="n">User</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">):</span>
        <span class="n">user</span> <span class="o">=</span> <span class="kc">None</span>
        
    <span class="c1">#Activate user</span>
    <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">account_activation_token</span><span class="o">.</span><span class="n">check_token</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="n">user</span><span class="o">.</span><span class="n">is_active</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">user</span><span class="o">.</span><span class="n">registeruser</span><span class="o">.</span><span class="n">email_confirmed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

        <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">backend</span><span class="o">=</span><span class="s2">&quot;django.contrib.auth.backends.ModelBackend&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;account_activated&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;email_confirmation_invalid.html&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We will get the user based on the link and activate user if the user exist. The link will be invalid a short time after the user is activated.</p>
</div>
<div class="section" id="related-templates">
<span id="related-templates"></span><h3>Related Templates<a class="headerlink" href="#related-templates" title="Permalink to this headline">¶</a></h3>
<p>The web page that user is redirected to after they register:</p>
<p>email_confirmation_sent.html:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">content</span> <span class="o">%</span><span class="p">}</span>
    <span class="o">&lt;</span><span class="n">h4</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;emailconfirm&quot;</span><span class="o">&gt;</span><span class="n">Email</span> <span class="n">confirmation</span> <span class="n">sent</span><span class="o">&lt;/</span><span class="n">h4</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">We</span> <span class="n">have</span> <span class="n">sent</span> <span class="n">an</span> <span class="n">account</span> <span class="n">confirmation</span> <span class="n">to</span> <span class="n">your</span> <span class="n">email</span><span class="o">.</span> <span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span>
    <span class="n">Please</span> <span class="n">confirm</span> <span class="n">your</span> <span class="n">email</span> <span class="n">address</span> <span class="n">to</span> <span class="n">complete</span> <span class="n">the</span> <span class="n">registration</span><span class="o">.</span> <span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">p</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;color: red&quot;</span><span class="o">&gt;</span><span class="n">If</span> <span class="n">you</span> <span class="n">don</span><span class="s1">&#39;t confirm your email, you will not be able to sign in!&lt;/p&gt;</span>
    <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;&lt;</span><span class="n">a</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;color: deepskyblue&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="o">&gt;</span><span class="n">Go</span> <span class="n">back</span> <span class="n">to</span> <span class="n">home</span> <span class="n">page</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endblock</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Template for the confirmation email sent to user:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>{% autoescape off %}
Hi {{ user.username }},

    Welcome to CAM2!
    Please click on the link below to confirm your registration:
    http://{{ domain }}{% url &#39;activate&#39; uidb64=uid token=token %}

    If you did not sign up for CAM2 website, it might be somebody else that mistakenly use your email for registration.
    We are very sorry for the inconvenience!

Sincerely,
CAM2
http://{{ domain }}
{% endautoescape %}
</pre></div>
</div>
<p>The variables inside <code class="docutils literal"><span class="pre">{{</span> <span class="pre">}}</span></code> must match what we defined in <code class="docutils literal"><span class="pre">render_to_string</span></code> in <code class="docutils literal"><span class="pre">views.py</span></code>.</p>
<p>The web page when user open the link in confirmation email:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>{% block content %}
    &lt;h4&gt;Account Successfully Activated&lt;/h4&gt;
    &lt;p&gt;Congratulations! your account has been successfully activated!&lt;/p&gt;
    &lt;p&gt;The website will automatically go back to home page in 5 seconds.&lt;/p&gt;
    &lt;p&gt;&lt;a style=&quot;color: deepskyblue&quot; href=&quot;/&quot;&gt;Click here if there&#39;s no response&lt;/a&gt;&lt;/p&gt;
    &lt;script&gt;
        function redirect(){
            window.location.href = &quot;/&quot;;
        }
        setTimeout(redirect, 5000);
    &lt;/script&gt;
{% endblock %}
</pre></div>
</div>
<p>The function in script makes sure that the website will be redirected to the home page after 5 seconds.</p>
</div>
</div>
<div class="section" id="contact-us">
<span id="contact-us"></span><h2>2.Contact Us<a class="headerlink" href="#contact-us" title="Permalink to this headline">¶</a></h2>
<div class="section" id="goal">
<span id="goal"></span><h3>Goal<a class="headerlink" href="#goal" title="Permalink to this headline">¶</a></h3>
<p>Under email_system app, creating a page for user to contact our website.</p>
</div>
<div class="section" id="approach">
<span id="id1"></span><h3>Approach<a class="headerlink" href="#approach" title="Permalink to this headline">¶</a></h3>
<p>Using a form that requires user to input &#8220;Name, email, subject and message&#8221; and the content into an email template. And then email admin.
In <code class="docutils literal"><span class="pre">forms.py</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ContactForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">from_email</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">EmailField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">subject</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">message</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">Textarea</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>2 new urls needed to be linked: one for contact us, and one for notifying user the email has been sent.
In <code class="docutils literal"><span class="pre">urls.py</span></code>, add:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^contact/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">contact</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;contact&#39;</span><span class="p">),</span>
<span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^email_sent/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">email_sent</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;email_sent&#39;</span><span class="p">),</span>
</pre></div>
</div>
<p>2 new views corresponding to the two urls are added.
The one that tells user email has been seet only needs a template:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">email_sent</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;email_system/email_sent.html&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The second one is the view for contact us page:
First we get everything user input and add them into our email template. And then we email our website host.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">contact</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ContactForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="c1">#get info from form</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">from_email</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;from_email&#39;</span><span class="p">]</span>
            <span class="n">subject</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span>
            <span class="c1">#add info to email template</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">render_to_string</span><span class="p">(</span><span class="s1">&#39;email_system/contact_email_template.html&#39;</span><span class="p">,</span> <span class="p">{</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
                <span class="s1">&#39;from_email&#39;</span><span class="p">:</span> <span class="n">from_email</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
            <span class="p">})</span>
            <span class="k">try</span><span class="p">:</span>
                 <span class="n">send_mail</span><span class="p">(</span><span class="n">subject</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">from_email</span><span class="p">,</span> <span class="p">[</span><span class="n">EMAIL_HOST_USER</span><span class="p">])</span><span class="c1">#email admin</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;Email sent failed.&#39;</span><span class="p">)</span>  <span class="c1"># error message</span>

            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;email_sent&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">ContactForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s2">&quot;email_system/contact.html&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="related-templates">
<span id="id2"></span><h3>Related Templates<a class="headerlink" href="#related-templates" title="Permalink to this headline">¶</a></h3>
<p>Email template:
<code class="docutils literal"><span class="pre">contact_email_template.html</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Contact</span> <span class="n">Name</span><span class="p">:</span>
<span class="p">{{</span> <span class="n">name</span> <span class="p">}}</span>

<span class="n">Email</span><span class="p">:</span>
<span class="p">{{</span> <span class="n">from_email</span> <span class="p">}}</span>

<span class="n">Content</span><span class="p">:</span>
<span class="p">{{</span> <span class="n">message</span> <span class="p">}}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="send-email-from-admin">
<span id="send-email-from-admin"></span><h2>3. Send Email from Admin<a class="headerlink" href="#send-email-from-admin" title="Permalink to this headline">¶</a></h2>
<p>See <a class="reference external" href="https://purduecam2project.github.io/CAM2WebUI/implementationDetail/Admin.html#admin-action-of-send-email-from-admin">here</a>
for admin action of &#8220;send email from admin&#8221; that direct admin to this view.</p>
<div class="section" id="goal">
<span id="id3"></span><h3>Goal<a class="headerlink" href="#goal" title="Permalink to this headline">¶</a></h3>
<p>Receive a list of user id from previous page, and allow admin to input subject and message to send email to users in the list.
The admin can also add other recipient by adding email addresses into the &#8220;additional email&#8221; box.</p>
</div>
<div class="section" id="decorator">
<span id="decorator"></span><h3>decorator<a class="headerlink" href="#decorator" title="Permalink to this headline">¶</a></h3>
<p>To make sure only admin can use this view, we need to add a django decorator <code class="docutils literal"><span class="pre">&#64;staff_member_required</span></code> before our function.</p>
</div>
<div class="section" id="send-email-page">
<span id="send-email-page"></span><h3>Send Email Page<a class="headerlink" href="#send-email-page" title="Permalink to this headline">¶</a></h3>
<p>we use a form to obtain the subject, message and additional email:
In `forms.py&#8217;:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="kn">from</span> <span class="nn">django</span> <span class="k">import</span> <span class="n">forms</span>
    <span class="kn">from</span> <span class="nn">django.core.validators</span> <span class="k">import</span> <span class="n">validate_email</span>
    
    <span class="k">class</span> <span class="nc">MailForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
        <span class="n">email</span> <span class="o">=</span> <span class="n">MultiEmailField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">help_text</span><span class="o">=</span><span class="s1">&#39;Split email by &quot; ,  &quot; or &quot; ; &quot;, or copy paste a list from below&#39;</span><span class="p">)</span>
        <span class="n">email_all_users</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">subject</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">forms</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">widget</span><span class="o">=</span><span class="n">forms</span><span class="o">.</span><span class="n">Textarea</span><span class="p">)</span>
</pre></div>
</div>
<p>Since we want to send email to more than one address, we need to define a field that accepts multiple email addresses.
See <a class="reference external" href="https://docs.djangoproject.com/en/1.11/ref/forms/validation/#form-field-default-cleaning">Django Documentation: Form field default cleaning</a></p>
<p>Before <code class="docutils literal"><span class="pre">Mailform</span></code>, add:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="k">class</span> <span class="nc">MultiEmailField</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="c1">#Modify the input so that email can be split by , and ;</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> 
            <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">value</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">value</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1">#remove the last &#39;,&#39; or &#39;;&#39;</span>

            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Check if value consists only of valid emails.&quot;&quot;&quot;</span>
            <span class="c1"># Use the parent&#39;s handling of required fields, etc.</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">MultiEmailField</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">email</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">validate_email</span><span class="p">(</span><span class="n">email</span><span class="p">)</span>
</pre></div>
</div>
<p>The MultiEmailField will accept a list of email addresses that is split by <code class="docutils literal"><span class="pre">,</span></code> or <code class="docutils literal"><span class="pre">;</span></code> aas well as a list copy and paste from the user info table that we will create later.</p>
<p>Now go to <code class="docutils literal"><span class="pre">views.py</span></code>. We will use <code class="docutils literal"><span class="pre">request.session</span></code> to pass the user id list from another web page.</p>
<p>And we want to show the info of selected user at the bottom of the view for admin&#8217;s convenience.</p>
<p>Therefore, we will first get the <code class="docutils literal"><span class="pre">User</span></code> object from user id, and form a list containing the information we need.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@staff_member_required</span>
<span class="k">def</span> <span class="nf">admin_send_email</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1">#obtain user id list from session, or none</span>
    <span class="n">user_selected</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_id_selected&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="c1">#get a list of User objects</span>
    <span class="n">user_info</span><span class="o">=</span><span class="p">[]</span>
    <span class="k">if</span> <span class="n">user_selected</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">user_selected</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">=</span><span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
            <span class="n">obj_info</span><span class="o">=</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">is_staff</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">email</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">last_name</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">date_joined</span><span class="p">]</span>
            <span class="n">user_info</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj_info</span><span class="p">)</span>
</pre></div>
</div>
<p>To retrieve input from admin:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">MailForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="c1">#get admin input</span>
            <span class="n">subject</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span>
            <span class="n">email</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">cleaned_data</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>There are two ways of sending email: send_mail and send_mass_mail. send_mass_mail will not close the channel of sending email after each email es sent, so it is slightly faster when sending a lot of email.</p>
<p>send_mass_mail accepts the email in the format: <code class="docutils literal"><span class="pre">(subject,</span> <span class="pre">message,</span> <span class="pre">from_email,</span> <span class="pre">recipient_list)</span></code>. See <a class="reference external" href="https://docs.djangoproject.com/en/1.11/topics/email/#send-mass-mail">Django Documentation: send_mass_mail()</a>.</p>
<p>It is better to send the email one by one, that is, we only put one email at a time in the <code class="docutils literal"><span class="pre">recipienct_list</span></code>, because all the email in <code class="docutils literal"><span class="pre">recipienct_list</span></code> is visible to others in the same <code class="docutils literal"><span class="pre">recipienct_list</span></code>.</p>
<p>To send the email one by one, we need to create a list to put all of our email, and then iterate through the user list to get their username and email. The username will be used for greeting in the email template.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>                    
            <span class="n">current_site</span> <span class="o">=</span> <span class="n">get_current_site</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>  <span class="c1"># will be used in templates</span>
            <span class="n">mass_email</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="c1">#for user id list</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">user_selected</span><span class="p">:</span>
                <span class="n">obj</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">email</span> <span class="ow">is</span> <span class="ow">not</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">username</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">username</span>  <span class="c1"># will be used in template</span>
                    <span class="n">template</span> <span class="o">=</span> <span class="n">render_to_string</span><span class="p">(</span><span class="s1">&#39;email_system/admin_send_email_template.html&#39;</span><span class="p">,</span> <span class="p">{</span>
                        <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
                        <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
                        <span class="s1">&#39;domain&#39;</span><span class="p">:</span> <span class="n">current_site</span><span class="o">.</span><span class="n">domain</span><span class="p">,</span>
                    <span class="p">})</span>
                    <span class="n">mass_email</span><span class="o">.</span><span class="n">append</span><span class="p">((</span>
                        <span class="n">subject</span><span class="p">,</span>
                        <span class="n">template</span><span class="p">,</span>
                        <span class="n">EMAIL_HOST_USER</span><span class="p">,</span>
                        <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">email</span><span class="p">],</span>
                    <span class="p">))</span>
            <span class="n">send_mass_mail</span><span class="p">(</span><span class="n">mass_email</span><span class="p">,</span> <span class="n">fail_silently</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>To email additional recipient is easy, just do another for loop iterating the email list: <code class="docutils literal"><span class="pre">for</span> <span class="pre">e</span> <span class="pre">in</span> <span class="pre">email:</span></code>.</p>
<p>Assign each email address as username for greeting in template. <code class="docutils literal"><span class="pre">username</span> <span class="pre">=</span> <span class="pre">e</span></code></p>
<p>And change the recipient_list to <code class="docutils literal"><span class="pre">[e]</span></code>. All the other code can be reused directly.</p>
<p>At last, finish the function, the else matches the <code class="docutils literal"><span class="pre">if</span> <span class="pre">request.method</span> <span class="pre">==</span> <span class="pre">'POST':</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>    <span class="k">else</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">MailForm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;email_system/admin_send_email.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;form&#39;</span><span class="p">:</span> <span class="n">form</span><span class="p">,</span> <span class="s1">&#39;users&#39;</span><span class="p">:</span> <span class="n">user_info</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="template">
<span id="template"></span><h3>Template<a class="headerlink" href="#template" title="Permalink to this headline">¶</a></h3>
<p>Email template:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Hi</span> <span class="p">{{</span> <span class="n">username</span> <span class="p">}},</span>
<span class="p">{{</span> <span class="n">message</span> <span class="p">}}</span>



<span class="n">Sincerely</span><span class="p">,</span>
<span class="n">CAM2</span>
<span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="p">{{</span> <span class="n">domain</span> <span class="p">}}</span>
</pre></div>
</div>
<p>View template:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="n">block</span> <span class="n">content</span> <span class="o">%</span><span class="p">}</span>
<span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;top-content&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;inner-bg&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;container&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="o">&gt;</span>
          <span class="o">&lt;</span><span class="n">a</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;color: blue&quot;</span> <span class="n">href</span><span class="o">=</span><span class="s2">&quot;/admin/auth/user/&quot;</span><span class="o">&gt;</span><span class="n">Go</span> <span class="n">back</span> <span class="n">to</span> <span class="n">User</span> <span class="n">administration</span><span class="o">&lt;/</span><span class="n">a</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">h3</span><span class="o">&gt;</span><span class="n">Email</span> <span class="n">Users</span><span class="o">&lt;/</span><span class="n">h3</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">messages</span> <span class="o">%</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="n">ul</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;color: red&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;messages&quot;</span><span class="o">&gt;</span>
            <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">messages</span> <span class="o">%</span><span class="p">}</span>
            <span class="o">&lt;</span><span class="n">li</span><span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">tags</span> <span class="o">%</span><span class="p">}</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;{{ message.tags }}&quot;</span><span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">message</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
            <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
        <span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
      <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;form-bottom&quot;</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="n">form</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="o">&gt;</span>
        <span class="p">{</span><span class="o">%</span> <span class="n">csrf_token</span> <span class="o">%</span><span class="p">}</span>
        <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">form</span> <span class="o">%</span><span class="p">}</span>
            <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="n">form</span><span class="o">.</span><span class="n">email</span> <span class="o">%</span><span class="p">}</span>
                <span class="p">{{</span> <span class="n">field</span><span class="o">.</span><span class="n">label_tag</span> <span class="p">}}</span><span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;width: 100%&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;{{ form.email.name }}&quot;</span><span class="o">/&gt;</span>
            <span class="p">{</span><span class="o">%</span> <span class="k">else</span> <span class="o">%</span><span class="p">}</span>
                <span class="p">{{</span> <span class="n">field</span><span class="o">.</span><span class="n">label_tag</span> <span class="p">}}</span><span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span>
                <span class="p">{{</span> <span class="n">field</span> <span class="p">}}</span><span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span>
            <span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
            <span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">help_text</span> <span class="o">%</span><span class="p">}</span>
                <span class="o">&lt;</span><span class="n">p</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;color: grey&quot;</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">field</span><span class="o">.</span><span class="n">help_text</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
            <span class="p">{</span><span class="o">%</span> <span class="n">endif</span> <span class="o">%</span><span class="p">}</span>
            <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">error</span> <span class="ow">in</span> <span class="n">field</span><span class="o">.</span><span class="n">errors</span> <span class="o">%</span><span class="p">}</span>
                <span class="o">&lt;</span><span class="n">p</span> <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;emailerror&quot;</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;color: red&quot;</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">error</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
            <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>

        <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
        <span class="o">&lt;</span><span class="n">button</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;sendemail&quot;</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;btn&quot;</span><span class="o">&gt;</span><span class="n">Send</span><span class="o">&lt;/</span><span class="n">button</span><span class="o">&gt;</span>

        <span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">br</span><span class="o">&gt;</span>
        <span class="o">&lt;</span><span class="n">div</span> <span class="n">class</span><span class="o">=</span><span class="s2">&quot;infoTable&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">table</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;width:100%; float: left&quot;</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">h3</span><span class="o">&gt;</span><span class="n">Selected</span> <span class="n">Users</span><span class="o">&lt;/</span><span class="n">h3</span><span class="o">&gt;</span>
            <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Staff</span> <span class="n">Status</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Username</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Email</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">First</span> <span class="n">Name</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Last</span> <span class="n">Name</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
                <span class="o">&lt;</span><span class="n">th</span><span class="o">&gt;</span><span class="n">Date</span> <span class="n">Joined</span><span class="o">&lt;/</span><span class="n">th</span><span class="o">&gt;</span>
            <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>

            <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span> <span class="o">%</span><span class="p">}</span>
                <span class="o">&lt;</span><span class="n">tr</span><span class="o">&gt;</span>
                <span class="p">{</span><span class="o">%</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">user</span> <span class="o">%</span><span class="p">}</span>
                    <span class="o">&lt;</span><span class="n">td</span><span class="o">&gt;</span><span class="p">{{</span> <span class="n">field</span> <span class="p">}}</span><span class="o">&lt;/</span><span class="n">td</span><span class="o">&gt;</span>
                <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>
                <span class="o">&lt;/</span><span class="n">tr</span><span class="o">&gt;</span>
            <span class="p">{</span><span class="o">%</span> <span class="n">endfor</span> <span class="o">%</span><span class="p">}</span>

            <span class="o">&lt;/</span><span class="n">table</span><span class="o">&gt;</span>

        <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
      <span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
    <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
  <span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">div</span><span class="o">&gt;</span>
<span class="p">{</span><span class="o">%</span> <span class="n">endblock</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Admin.html" class="btn btn-neutral float-right" title="Admin" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="CameraPopUpView.html" class="btn btn-neutral" title="Camera Pop Up View" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Purdue CAM2 Project Developers.
      Last updated on Sep 24, 2018.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>